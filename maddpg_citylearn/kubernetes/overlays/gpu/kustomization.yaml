# Kustomization overlay para GPU - MADDPG CTDE v3.0.0-ep50
# ============================================================================
# Modelo: MADDPG CTDE Cooperative con aceleraci√≥n GPU CUDA
# Entrenado: 50 episodios (438,000 steps) en RTX 4060
# Uso: kubectl apply -k kubernetes/overlays/gpu/

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Referencia a la base
resources:
  - ../../

# Imagen del modelo entrenado con soporte GPU
images:
  - name: maddpg-citylearn
    newTag: v3.0.0-ep50

# Parches para habilitar GPU
patches:
  - patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: maddpg-citylearn
        annotations:
          model-version: "v3.0.0-ep50"
          trained-episodes: "50"
          trained-device: "cuda-rtx4060"
      spec:
        template:
          spec:
            containers:
            - name: maddpg-api
              resources:
                requests:
                  memory: "4Gi"
                  cpu: "2000m"
                  nvidia.com/gpu: "1"
                limits:
                  memory: "8Gi"
                  cpu: "4000m"
                  nvidia.com/gpu: "1"
              env:
              - name: CUDA_VISIBLE_DEVICES
                value: "0"
              - name: NVIDIA_VISIBLE_DEVICES
                value: "all"
              - name: NVIDIA_DRIVER_CAPABILITIES
                value: "compute,utility"
              - name: MODEL_VERSION
                value: "v3.0.0-ep50"
              - name: DEVICE
                value: "cuda"
            tolerations:
            - key: "nvidia.com/gpu"
              operator: "Exists"
              effect: "NoSchedule"
            nodeSelector:
              accelerator: nvidia-gpu

# Etiquetas adicionales para GPU
commonLabels:
  gpu-enabled: "true"
  model-version: v3.0.0-ep50

# Anotaciones para monitoreo GPU
commonAnnotations:
  gpu.nvidia.com/enabled: "true"
  model.maddpg/trained-episodes: "50"
