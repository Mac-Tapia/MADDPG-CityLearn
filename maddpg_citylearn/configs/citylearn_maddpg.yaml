# Configuración MADDPG para CityLearn v2.5 - Comparación con MARLISA
# =================================================================
# Este archivo configura MADDPG para ser comparable con MARLISA:
# - Mismo schema: citylearn_challenge_2022_phase_all_plus_evs
# - Misma reward function: Electric_Vehicles_Reward_Function (nativa)
# - Mismos KPIs de evaluación
# - 17 agentes (edificios), 8760 steps/episodio

env:
  # Dataset con vehículos eléctricos - IGUAL QUE MARLISA
  schema: "citylearn_challenge_2022_phase_all_plus_evs"
  simulation_start_time_step: null  # Usar todo el año
  simulation_end_time_step: null    # 8760 steps
  # Usar reward function NATIVA de CityLearn (Electric_Vehicles_Reward_Function)
  # Esto asegura comparación justa con MARLISA que también la usa
  reward_function: null  # null = usa la del schema (EV_Reward_Function)
  # NO usar reward_weights custom para comparación justa
  reward_weights: null

maddpg:
  # === HIPERPARÁMETROS - Comparación con MARLISA ===
  # MARLISA usa: gamma=0.99, tau=0.005, lr=0.0003, hidden=[400,300], batch=100
  gamma: 0.99               # IGUAL que MARLISA
  tau: 0.005                # IGUAL que MARLISA
  actor_lr: 0.0003          # IGUAL que MARLISA
  critic_lr: 0.0003         # IGUAL que MARLISA (lr único)
  hidden_dim: 400           # Similar a MARLISA [400, 300] (primera capa)
  # === BUFFER Y BATCH - Optimizado para GPU ===
  # MARLISA usa: batch=100, buffer=100k
  # Nosotros aumentamos para mejor uso de GPU
  buffer_size: 100000       # IGUAL que MARLISA para comparación justa
  batch_size: 256           # Mayor que MARLISA para mejor GPU (100 -> 256)
  device: "cuda"            # GPU RTX 4060 Laptop
  # === EXPLORACIÓN ===
  exploration_initial_std: 0.3    # Exploración inicial
  exploration_final_std: 0.05     # Exploración mínima
  exploration_decay_steps: 175000 # ~20 episodios
  # === SCHEDULING DE UPDATES ===
  update_after: 8760        # 1 episodio completo antes de entrenar
  update_every: 50          # Updates moderados (similar a SAC)
  updates_per_step: 1       # 1 update por ciclo (como MARLISA)

training:
  # === ENTRENAMIENTO COMPARABLE CON MARLISA ===
  episodes: 50              # Suficientes para convergencia
  log_every: 1              # Log cada episodio
  max_steps_per_episode: null  # 8760 steps completos (1 año)
  seed: 42                  # Reproducibilidad
  save_dir: "models/citylearn_maddpg"
  # === VALIDACIÓN Y EARLY STOPPING ===
  val_every: 5              # Validar cada 5 episodios
  val_episodes: 1           # 1 episodio de validación
  early_stopping_patience: 10    # Paciencia amplia
  early_stopping_min_delta: 50.0  # Delta razonable

api:
  host: "0.0.0.0"
  port: 8000
  reload: false
  checkpoint_path: "models/citylearn_maddpg/maddpg.pt"
